/*
 * Kernel
 */
memory PAGE_OFFSET	0x80000000
memory KSTACK_SIZE	4096
memory IRQSTACK_SIZE	4096
option TIME_SLICE_MS	50
option HZ		1000
option PAGE_SIZE	0x1000
option MA_NORMAL_ATTR	(MA_SPEED_0)
option MA_FAST_ATTR	(MA_SPEED_0)
option IRQS		196

/*
 * RAM
 */
memory RAM_BASE		0x80000000
memory RAM_SIZE		0x8000000

/*
 * There must be at least 8MiB of space remaining after the boot image as QEMU
 * puts a devicetree there. QEMU adds 24MiB to the kernel size so we need to
 * be at least 32MiB + BOOTIMAGE_SIZE from the end of RAM.
 */
memory BOOTIMAGE_SIZE	0x1000000
memory BOOTIMAGE_BASE	(CONFIG_RAM_BASE_VIRT + CONFIG_RAM_SIZE - 0x3000000)
memory LOADER_RAM_SIZE	0x2000
memory LOADER_RAM_BASE	(CONFIG_BOOTIMAGE_BASE_VIRT - CONFIG_LOADER_RAM_SIZE)

/*
 * Kernel at start of RAM
 */
memory KERNEL_BASE	(CONFIG_RAM_BASE_VIRT)
memory KERNEL_MAX_SIZE	(CONFIG_LOADER_RAM_BASE_VIRT - CONFIG_KERNEL_BASE_VIRT)

/*
 * Device drivers
 */
driver-1 sys/dev/intc/openpic{.base = 0xfe0040000_phys}
driver sys/dev/powerpc/booke/decrementer-systick{.clock = 400000000}
driver sys/dev/serial/ns16550{.name = "ttyS0", .base = 0xfe004500, .clock = 0, .ipl = IPL_MIN, .irq = 42, .irq_mode = OPENPIC_LEVEL_HIGH}

/*
 * CPU
 */
cpu powerpc/e500v2

/*
 * QEMU
 */
option QEMU_IMG qemu_ppce500_bootimg.elf
option QEMU_CMD qemu-system-ppc -nographic -machine ppce500 -kernel
finalmk machine/qemu/powerpc/ppce500/image/image.mk

/*
 * Pretty machine name
 */
option MACHINE_NAME QEMU Generic Paravirtualised PowerPC e500 Platform
